@startuml
'==============================
'【Main method】（アクション分類・プレイヤー毎処理）
'==============================
|Main method|
start
:[6-1] 誘発したアクションを分類しバッファに追加;
note right
    「即時/通常 × メイン/クイック」で分類
end note
note right
    誘発したアクションのコントローラーは
    起因となったアクションのコントローラー
    になります。
end note

while ([6-2] バッファは空か？) is (No) 
  ' 外部ループ：バッファに何らかのアクションが残っている限り処理する

  '-------------------------------------------
  '【即時効果：プレイヤー毎に処理】
  '-------------------------------------------
  while ([6-3] バッファに即時効果はあるか？) is (Yes)

    group 即時効果: プレイヤー毎に処理
    note
        順番はターンプレイヤーから
        ターンが回る順に行う
    end note

      while ([6-4] 該当プレイヤーに即時効果があるか？) is (Yes)
        :[6-5] タイミング=メインの即時アクションを処理;
        note right
          別フロー呼び出し
        end note
        :[6-6] タイミング=クイックの即時アクションを処理;
        note right
          別フロー呼び出し
        end note
        :[6-7] 次のプレイヤーへ;
      endwhile (No)
    end group
  endwhile (No)

  '-------------------------------------------
  '【通常効果：プレイヤー毎に処理】
  '-------------------------------------------
  while ([6-8] バッファに通常効果はあるか？) is (Yes)

    group 通常効果: プレイヤー毎に処理
    note
        順番はターンプレイヤーから
        ターンが回る順に行う
    end note

      while ([6-9] 該当プレイヤーに通常効果があるか？) is (Yes)
        :[6-10] タイミング=メインの通常アクションを処理;
        note right
          別フロー呼び出し
        end note
        :[6-11] タイミング=クイックの通常アクションを処理;
        note right
          別フロー呼び出し
        end note
        :[6-12] 次のプレイヤーへ;
      endwhile (No)
    end group
  endwhile (Yes)

endwhile (Yes)
stop
@enduml
