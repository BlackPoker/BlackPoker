==============================
コアルール
==============================

コアルールでは、ターン制ゲームに適用できる割込み処理についてルールを定義します。

コアルールは、次の図を中心に説明します。(:numref:`coreflow-1`)
詳細は後ほど説明しますが、ゲーム開始から勝敗が決まるまでこの図に集約して説明します。

.. _coreflow-1:
.. uml:: coreflow.puml
   :caption: コアフロー


ターン
==============================
このルールを説明する上でターンとは、ターンは持つことができるものとします。
ターンを持っているプレイヤーは先に行動することができます。
ターンを持っているプレイヤーをターンプレイヤーといいます。


アクション
==============================
アクションとは、プレイヤーの行動を示します。
ターン制のゲームでは、プレイヤーは様々な行動を行います。
チェスであればコマを進めたり、ババ抜きであれば隣の人からカードを引くなどがあります。
それらをアクションと定義します。


------------------------------
アクションの項目
------------------------------

アクションは次の項目を定義する必要があります。
他の項目は具体的にアクションを定義する際に、ゲームに合わせて追加して下さい。

 * 効果（通常効果・即時効果）
 * タイミング


効果
------------------------------
効果とはその効果を発揮した際に、プレイヤーが行う行動です。
効果の中には、通常効果と即時効果があります。
違いについては、後述します。


タイミング
------------------------------
タイミングとは、アクションを起こすことができる時を示します。
タイミングには「メイン」と「クイック」の2種類あります。

.. todo:: タイミングについては説明しないほうがスッキリするかも？？

    メインとクイックについては後々説明

------------------------------
エンドアクションの定義
------------------------------
定義するアクションの中で最低１つは
ターンを別のプレイヤーにわたす効果を定義してください。
そうしないと、ターンが別のプレイヤーに渡らす、ゲームが進行しなくなります。

.. todo:: 例を書く



チャンス
==============================
アクションを起こすことができる機会をチャンスといいます。
チャンスを持っている間は何度でもアクションを起こすことができます。


ステージ
==============================
アクションの解決順を整理するために使う領域です。
後入れ先出し方式で最後に積まれたアクションから順に解決されていきます。


コアフロー
==============================
ここまでの説明を踏まえて、冒頭に紹介した図を説明します。(:numref:`coreflow-2`)

.. _coreflow-2:
.. uml:: coreflow.puml
   :caption: コアフロー


①ゲーム開始
    先攻を決め、ゲームを始める準備を行います。

②ターンプレイヤーにチャンスを移動
    ターンを持っているプレイヤーにチャンスを移動します。

③ステージが空か？
    ステージにアクションが存在していないか判定します。

④パス名簿リセット
    パスしたプレイヤーを記録するパス名簿をリセットします。

⑤アクション起こす
    アクションを起こしこれからプレイヤーが行うことを宣言します。
    ゲームによってアクションの起こし方は異なります。BlackPokerではアクション名を言い、コストの支払や対象を指定しアクションを起こします。
    一方ババ抜きでは、隣のプレイヤーからカードを引く際に宣言せず暗黙にアクションが起きている場合もあります。

⑥即時か？
    起こしたアクションが即時効果か通常効果か判定します。

⑦効果解決
    アクションの効果に定義されている内容を実行します。

⑧ステージに追加
    ステージというアクションを貯めておける領域に追加します。

⑨誘発チェック
    .. todo:: 詳しいフローを記載する

⑩アクションを起こすか？
    チャンスを持っているプレイヤーはアクションを起こすかを判断します。

⑪パス名簿に登録
    パスしたプレイヤーを記録するパス名簿に登録します。同じプレイヤー名は2回登録されません。

⑫パス名簿の件数=プレイヤー数か？
    パス名簿の件数がゲームに参加しているプレイヤーの数と一致しているか判定します。

⑬ステージから取出し
    最後にステージに追加されたアクションをステージから取出します。

⑭チャンス移動
    チャンスを持っているプレイヤーからチャンスを持っていないプレイヤーにチャンスを移動します。
    チャンスを移動するルールはゲームによって異なります。
