## 複雑なルールを分解する

### TCGのルールの複雑さ

TCG（トレーディングカードゲーム）のルールは非常に複雑です。詳細なルールを理解するには、分厚いルールブックを正確に理解する必要があります。私がこのゲームで実現したいのは、以下のようなやり取りです。

### 【コラム】なぜステージやチャンスといった複雑な手順があるか

対戦相手の行動に対して割り込むことを可能にするために、複雑な手順が存在します。以下のようなやり取りがその例です：

- **Aくん**：「この兵士アップします。」  
- **Bさん**：「その前にこの兵士ダウンします。」  
- **Aくん**：「じゃあそのダウンをカウンターします。」  
- **Bさん**：「それをさらにカウンターします。」  
- **Aくん**：「・・・（泣）」  
- **Bさん**：「（どやっ！）」  

カードゲームの醍醐味は、いかに相手の行動に対して意表をついた行動ができるかにあります。行動の割り込みを可能にするため、カードゲームで用いられている手法を参考にし、さらにシンプルにしてBlackPokerに取り入れました。

カードゲームを経験したことがある方には理解しやすいルールですが、未経験の方には少し難しいかもしれません。しかし、ここで理解すれば他のカードゲームにも応用が利くので、頑張って理解してみてください。

### ルールのシンプル化の必要性

ルールは全員が理解している必要があるため、簡単であることが望ましいです。しかし、複雑なやり取りにはそれ自体に魅力があります。一見複雑なルールをシンプルに整理できれば、みんなが魅力的なゲームで遊ぶことができると考えました。

TCGのルールは複雑で、審判が必要になるほどです。Q&Aのページも膨大で、全てのルールを細かく把握することは難しいです。ルールをシンプルにフローチャートなどの図を用いて説明できないかと考え、それをまとめたのが、以降に登場するコアフローです。

### フェイズの概念を廃止

TCGのルールはフェイズという概念を用いて全体の流れをわかりやすくしていますが、フェイズがあるため、割り込み処理の説明が複雑になっています。BlackPokerでは、割り込み処理の説明を簡潔にし、フェイズの概念をなくしました。また、状態による処理も最小限にし、常に確認しなければならない箇所も減らしました。誘発については、まだ整理の余地がありますが、割り込み処理を整理したことで比較的簡潔にまとめられており、さらにこれから改善していく予定です。

ここからは、なぜ今までの複雑なルールがコアフローで表現できるかを解説します。

### ターンを印と捉える

詳しい説明の前に、ターンとチャンスについて考える必要があります。TCGはターン制のゲームであるため、ターンは捉えやすいと思います。チャンスは優先権のことを指しており、BlackPokerではアクションを起こせる機会をアクションチャンス、略してチャンスと呼んでいます。

ターンという概念を捉える際に2つの捉え方があります。1つは期間、1つは印です。よくTCGでは「ターン終了時」という言葉が出てきますが、ここではターンを印と捉えることにしました。

ターンを期間と考えると矛盾が出てくるため、シンプルにターンという印があり、それを持っているプレイヤーがその人の手番であると考える方がわかりやすいです。ターンを持っているプレイヤーをアクティブプレイヤー（AP）、持っていないプレイヤーをノンアクティブプレイヤー（NAP）と呼びます。この定義をしないと後の説明が長文になるため、ご理解いただきたいです。

### アクションはプレイヤーの行動

TCGは多くのカードが用意されており、多くのカードを手に入れることで、多くのアクション（行動）を取ることが可能になります。TCGのカードを分解すると、プレイヤーが取れるアクションの種類と概ね同等になると考えられます。

BlackPokerではトランプを使用しているため、カードの種類ではなく、アクションの種類を増やすことで、TCGの持つ豊富なカードプールを表現しています。コアフローでは、このアクションをどのように解決するかを整理しています。

### フェイズはフローを複雑にする

多くのTCGではフェイズを用いてターン内で行えるプレイヤーの行動をわかりやすくしています。しかし、面白いTCGでは相手の行動に対して多く干渉してきます。それはフェイズも例外ではありません。ターン終了時に重ねて割り込み処理をしたり、ターンの開始時にターンを持っているプレイヤーのキャラクターが再度利用可能になったりするなどです。

プレイヤーが様々な行動をできるようにルールを作成すると、フェイズで行う行動に対してもプレイヤーが干渉できるようになります。自由はルールを複雑にします。

BlackPokerではフェイズもプレイヤーがターン内に行えるアクション（行動）として捉え、TCGのカードが起こすアクションと同様に扱います。そうすることで、コアフローをシンプルにすることができました。

他のTCGではコアフローのようにフローチャート形式の図でルールを表現することは難しいですが、フェイズは理解をしやすくするツールであり、根幹的には不要だと考えています。

### アクションの処理順を定義するステージ

BlackPokerではプレイヤーが起こしたアクションをステージという場所で管理します。TCGではスタックと呼ばれることもあります。BlackPokerでも初期の頃はスタックという名称にしていましたが、より広い意味で定義するため、ステージという単語に変更しました。

TCGのスタックは棚のイメージで考えられます。棚に物を詰めていくと先に詰めたものは後から詰めたものが邪魔になり、取り出せなくなります。このことから先入れ後出し方式の意味となり、割り込み処理をする際にうまく機能します。

BlackPokerではステージとして、アクションが舞台に上がるイメージにしました。舞台に上がりスポットライトが当たり、また誰かが舞台に上がりスポットライトが当たる。舞台から降りる順番は順不同ですが、だいたい先入れ後出しのように動きます。しかし、先入れ後出しを強要しているわけではなく、スポットライトが当たる順番はルールによって変えられます。少し幅を持たせた表現にしています。